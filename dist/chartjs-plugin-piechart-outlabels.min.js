/*!
 * chartjs-plugin-piechart-outlabels v0.1.3
 * http://www.chartjs.org
 * (c) 2017-2022 chartjs-plugin-piechart-outlabels contributors
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Chart)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t),s={LABEL_KEY:"$outlabels",backgroundColor:function(t){return t.dataset.backgroundColor},borderColor:function(t){return t.dataset.backgroundColor},lineColor:function(t){return t.dataset.backgroundColor},borderRadius:0,borderWidth:0,lineWidth:2,color:"white",display:!0,font:{family:void 0,size:void 0,style:void 0,weight:null,maxSize:null,minSize:null,resizable:!0},lineHeight:1.2,padding:{top:4,right:4,bottom:4,left:4},textAlign:"center",stretch:40,text:"%l %p",zoomOutPercentage:50,percentPrecision:1,valuePrecision:3},h=function(){i.default.defaults.outlabeledDoughnut=i.default.defaults.doughnut,i.default.defaults.outlabeledPie=i.default.defaults.pie;class t extends i.default.PieController{update(t){super.update(t);var e=this.getMeta(),i=this.chart.options.zoomOutPercentage||s.zoomOutPercentage;this.outerRadius*=1-i/100,this.innerRadius*=1-i/100,this.updateElements(e.data,0,e.data.length,"resize")}}class e extends i.default.DoughnutController{update(t){super.update(t);var e=this.getMeta(),i=this.chart.options.zoomOutPercentage||s.zoomOutPercentage;this.outerRadius*=1-i/100,this.innerRadius*=1-i/100,this.updateElements(e.data,0,e.data.length,"resize")}}t.id="outlabeledPie",e.id="outlabeledDoughnut",i.default.register(t),i.default.register(e)},n=function(t,e){var i=(t.startAngle+t.endAngle)/2,s=Math.cos(i),h=Math.sin(i),n=t.outerRadius,r=n+e;return{x:t.x+s*r,y:t.y+h*r,d:r,arc:t,anchor:{x:t.x+s*n,y:t.y+h*n},copy:{x:t.x+s*r,y:t.y+h*r}}},r=function(t,e){var i=t.arc,s=t.d,h=(i.startAngle+i.endAngle)/2,n=Math.cos(h),r=Math.sin(h);return s+=e,{x:i.x+n*s,y:i.y+r*s,d:s,arc:i,anchor:t.anchor,copy:{x:i.x+n*s,y:i.y+r*s}}},l=i.default.helpers,a=s.LABEL_KEY,o=function(t,e,h,o,c){var d=i.default.helpers.resolve;if(!d([o.display,!0],c,e))throw new Error("Label display property is set to false.");var f=c.dataset.data[e],u=c.labels[e],x=d([o.text,s.text],c,e);((x=x.replace(/%l/gi,u)).match(/%v\.?(\d*)/gi)||[]).map((function(t){var e=t.replace(/%v\./gi,"");return e.length?+e:o.valuePrecision||s.valuePrecision})).forEach((function(t){x=x.replace(/%v\.?(\d*)/i,f.toFixed(t))})),(x.match(/%p\.?(\d*)/gi)||[]).map((function(t){var e=t.replace(/%p\./gi,"");return e.length?+e:o.percentPrecision||s.percentPrecision})).forEach((function(t){x=x.replace(/%p\.?(\d*)/i,(100*c.percent).toFixed(t)+"%")}));var g=x.match(/[^\r\n]+/g);if(!g||!g.length)throw new Error("No text to show.");for(var y=0;y<g.length;++y)g[y]=g[y].trim();this.init=function(i,n){this.encodedText=o.text,this.text=i,this.lines=n,this.label=u,this.value=f,this.ctx=h,this.style={backgroundColor:d([o.backgroundColor,s.backgroundColor,"black"],c,e),borderColor:d([o.borderColor,s.borderColor,"black"],c,e),borderRadius:d([o.borderRadius,0],c,e),borderWidth:d([o.borderWidth,0],c,e),lineWidth:d([o.lineWidth,2],c,e),lineColor:d([o.lineColor,s.lineColor,"black"],c,e),color:d([o.color,"white"],c,e),font:l.parseFont(d([o.font,{resizable:!0}]),h.canvas.style.height.slice(0,-2)),padding:l.toPadding(d([o.padding,0],c,e)),textAlign:d([o.textAlign,"left"],c,e)},this.stretch=d([o.stretch,40],c,e),this.size=l.textSize(h,this.lines,this.style.font),this.offsetStep=this.size.width/20,this.offset={x:0,y:0},this.predictedOffset=this.offset;var r=-(t.startAngle+t.endAngle)/2/Math.PI,a=Math.abs(r-Math.trunc(r));a>.45&&a<.55?this.predictedOffset.x=0:r<=.45&&r>=-.45?this.predictedOffset.x=this.size.width/2:r>=-1.45&&r<=-.55&&(this.predictedOffset.x=-this.size.width/2)},this.init(x,g),this.computeLabelRect=function(){var t=this.textRect.width+2*this.style.borderWidth+2*this.style.padding.left,e=this.textRect.height+2*this.style.borderWidth;return{x:this.textRect.x-this.style.borderWidth,y:this.textRect.y-this.style.borderWidth,width:t,height:e}};this.computeTextRect=function(){const t=this.center.x-this.center.copy.x<0?-60:60;return{x:this.center.x-this.size.width/2-this.style.padding.left+t,y:this.center.y-this.size.height/2-this.style.padding.top,width:this.size.width,height:this.size.height+this.style.padding.height}},this.getPoints=function(){return[{x:this.labelRect.x,y:this.labelRect.y},{x:this.labelRect.x+this.labelRect.width,y:this.labelRect.y},{x:this.labelRect.x+this.labelRect.width,y:this.labelRect.y+this.labelRect.height},{x:this.labelRect.x,y:this.labelRect.y+this.labelRect.height}]},this.containsPoint=function(t,e){return e||(e=5),this.labelRect.x-e<=t.x&&t.x<=this.labelRect.x+this.labelRect.width+e&&this.labelRect.y-e<=t.y&&t.y<=this.labelRect.y+this.labelRect.height+e},this.drawText=function(){var t,e,i,s=this.style.textAlign,h=this.style.font.lineHeight,n=this.style.color,r=this.lines.length;if(r&&n)for(t=this.textRect.x,e=this.textRect.y+h/2,"center"===s?t+=this.textRect.width/2:"end"!==s&&"right"!==s||(t+=this.textRect.width),this.ctx.font=this.style.font.string,this.ctx.fillStyle=n,this.ctx.textAlign=s,this.ctx.textBaseline="middle",i=0;i<r;++i)this.ctx.fillText(this.lines[i],Math.round(t)+this.style.padding.left,Math.round(e)+this.style.padding.top,Math.round(this.textRect.width)),e+=h},this.drawLabel=function(){h.beginPath(),this.ctx.fillRect(this.ctx,Math.round(this.labelRect.x),Math.round(this.labelRect.y),Math.round(this.labelRect.width),Math.round(this.labelRect.height),this.style.borderRadius),this.ctx.closePath(),this.style.backgroundColor&&(this.ctx.fillStyle=this.style.backgroundColor||"black",this.ctx.fill()),this.style.borderColor&&this.style.borderWidth&&(this.ctx.strokeStyle=this.style.borderColor,this.ctx.lineWidth=this.style.borderWidth,this.ctx.lineJoin="miter",this.ctx.stroke())},this.ccw=function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)},this.intersects=function(t,e,i,s){return this.ccw(t,i,s)!==this.ccw(e,i,s)&&this.ccw(t,e,i)!==this.ccw(t,e,s)},this.drawLine=function(){this.ctx.save(),this.ctx.strokeStyle=this.style.lineColor,this.ctx.lineWidth=this.style.lineWidth,this.ctx.lineJoin="miter",this.ctx.beginPath(),this.ctx.moveTo(this.center.anchor.x,this.center.anchor.y),this.ctx.lineTo(this.center.copy.x,this.center.copy.y),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.center.copy.x,this.center.copy.y);const t=this.textRect.width+this.style.padding.width,e=this.intersects(this.textRect,{x:this.textRect.x+this.textRect.width,y:this.textRect.y+this.textRect.height},this.center.copy,{x:this.textRect.x,y:this.textRect.y+this.textRect.height/2});this.ctx.lineTo(this.textRect.x+(e?t:0),this.textRect.y+this.textRect.height/2),this.ctx.stroke(),this.ctx.restore()},this.draw=function(){this.drawLabel(),this.drawText()},this.update=function(t,e,i){this.center=n(t,this.stretch),this.moveLabelToOffset(),this.center.x+=this.offset.x,this.center.y+=this.offset.y;for(var s=!1;!s;){this.textRect=this.computeTextRect(),this.labelRect=this.computeLabelRect();var h=this.getPoints();s=!0;for(var l=0;l<i;++l){var o=e[l][a];if(o)for(var c=o.getPoints(),d=0;d<h.length;++d){if(o.containsPoint(h[d])){s=!1;break}if(this.containsPoint(c[d])){s=!1;break}}}s||(this.center=r(this.center,1),this.center.x+=this.offset.x,this.center.y+=this.offset.y)}},this.moveLabelToOffset=function(){this.predictedOffset.x<=0&&this.offset.x>this.predictedOffset.x?(this.offset.x-=this.offsetStep,this.offset.x<=this.predictedOffset.x&&(this.offset.x=this.predictedOffset.x)):this.predictedOffset.x>=0&&this.offset.x<this.predictedOffset.x&&(this.offset.x+=this.offsetStep,this.offset.x>=this.predictedOffset.x&&(this.offset.x=this.predictedOffset.x))}},c=i.default.helpers,d=c.merge(c,{toFontString:function(t){return!t||c.isNullOrUndef(t.size)||c.isNullOrUndef(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family},textSize:function(t,e,i){var s,h=[].concat(e),n=h.length,r=t.font,l=0;for(t.font=i.string,s=0;s<n;++s)l=Math.max(t.measureText(h[s]).width,l);return t.font=r,{height:n*i.lineHeight,width:l}},parseFont:function(t,e){var s=i.default.defaults,h=c.valueOrDefault(t.size,s.defaultFontSize);t.resizable&&(h=this.adaptTextSizeToHeight(e,t.minSize,t.maxSize));var n={family:c.valueOrDefault(t.family,s.defaultFontFamily),lineHeight:c.toLineHeight(t.lineHeight,h),size:h,style:c.valueOrDefault(t.style,s.defaultFontStyle),weight:c.valueOrDefault(t.weight,null),string:""};return n.string=c.toFontString(n),n},adaptTextSizeToHeight:function(t,e,i){var s=t/100*2.5;return e&&s<e?e:i&&s>i?i:s}});h(),i.default.defaults.plugins.outlabels=s;var f=s.LABEL_KEY;i.default.register({id:"outlabels",resize:function(t){t.sizeChanged=!0},afterDatasetUpdate:function(t,e,i){var s,h,n,r,l,a,c=t.config.data.labels,u=t.data.datasets[e.index],x=function(t,e){var i=t.outlabels;return!1===i?null:(!0===i&&(i={}),d.merge({},[e,i]))}(u,i),g=x&&x.display,y=e.meta.data||[],p=t.ctx;for(p.save(),a=0;a<y.length;++a){if(h=(s=y[a])[f],n=u.data[a]/e.meta.total,r=null,g&&s&&!s.hidden)try{l={chart:t,dataIndex:a,dataset:u,labels:c,datasetIndex:e.index,percent:n},r=new o(s,a,p,x,l)}catch(t){r=null}h&&r&&!t.sizeChanged&&h.label===r.label&&h.encodedText===r.encodedText&&(r.offset=h.offset),s[f]=r}p.restore(),t.sizeChanged=!1},afterDatasetDraw:function(t,e){for(var i,s,h=e.meta.data||[],n=t.ctx,r=0;r<2*h.length;++r)(s=(i=h[r<h.length?r:r-h.length])[f])&&(r<h.length?(s.update(i,h,r),s.drawLine(n)):s.draw(n))}})}));
